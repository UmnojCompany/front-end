<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Создание заявки для поиска недвижимости</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/media.css" />
    <link rel="stylesheet" href="css/selects.css" />
  </head>
  <body>
    <main class="no-padding">
      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <section class="enter-page create-app">
        <div class="container">
          <a href="my-profile-customer.html" class="cancel">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M18.3647 5.63567C18.7552 6.02619 18.7552 6.65936 18.3647 7.04988L13.4148 11.9998L18.3646 16.9495C18.7551 17.34 18.7551 17.9732 18.3646 18.3637C17.974 18.7543 17.3409 18.7543 16.9504 18.3637L12.0006 13.414L7.05099 18.3636C6.66047 18.7541 6.0273 18.7541 5.63678 18.3636C5.24625 17.9731 5.24625 17.3399 5.63678 16.9494L10.5864 11.9998L5.63664 7.05002C5.24612 6.6595 5.24612 6.02633 5.63664 5.63581C6.02717 5.24528 6.66033 5.24528 7.05086 5.63581L12.0006 10.5856L16.9505 5.63567C17.341 5.24514 17.9742 5.24514 18.3647 5.63567Z"
                fill="#2A344A"
              />
            </svg>
          </a>
          <div class="wrapper head">
            <h3>Создание заявки для поиска недвижимости</h3>
            <div class="id-realtor">ID 10445</div>
          </div>
          <div class="wrapper">
            <div class="row">
              <div class="item">
                <div class="num">1</div>
                <div class="img">
                  <img src="img/app-01.svg" alt="" />
                </div>
                <div class="text">
                  <span>Создайте анонимную заявку</span>
                  <p>Опишите недвижимость, которую вы ищите</p>
                </div>
              </div>
              <div class="item">
                <div class="num">2</div>
                <div class="img">
                  <img src="img/app-02.svg" alt="" />
                </div>
                <div class="text">
                  <span>Получайте предложения</span>
                  <p>Риелторы сделают вам свои предложения</p>
                </div>
              </div>
              <div class="item">
                <div class="num">3</div>
                <div class="img">
                  <img src="img/app-03.svg" alt="" />
                </div>
                <div class="text">
                  <span>Обменивайтесь контактами</span>
                  <p>Откройте контакты подходящим риелторам</p>
                </div>
              </div>
            </div>
          </div>
          <div class="wrapper">
            <h3>Расположение <span>*</span></h3>
            <div class="subtitle">
              Укажите город, в котором вы ищите недвижимость. По желанию можете
              указать один или несколько районов
            </div>
            <div class="form start">
              <ul class="chek-lists-single">
                <li>Москва</li>
                <li>Санкт-Петербург</li>
              </ul>
            </div>
            <h5>Район</h5>
            <form class="gap custom-selects" action="">
              <div class="row">
                <div class="custom-select-container">
                  <div class="select-wrapper">
                    <div class="select-placeholder">
                      Укажите интересующие вас районы
                    </div>
                    <div class="custom-select" onclick="toggleOptions(this)">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 18 18"
                        fill="none"
                      >
                        <path
                          d="M4.5 7.75L8.64645 11.8964C8.84171 12.0917 9.15829 12.0917 9.35355 11.8964L13.5 7.75"
                          stroke="#7786A5"
                          stroke-width="1.5"
                          stroke-linecap="round"
                        />
                      </svg>
                    </div>
                    <div class="selected-items"></div>
                  </div>
                  <input
                    type="text"
                    class="search-input"
                    placeholder=""
                    oninput="filterOptions(this)"
                  />
                  <div class="custom-options">
                    <div class="custom-option">
                      <input type="checkbox" data-value="Option 1" />
                      <label>Option 1</label>
                    </div>
                    <div class="custom-option">
                      <input type="checkbox" data-value="Option 2" />
                      <label>Option 2</label>
                    </div>

                    <h4>Test</h4>
                    <div class="custom-option">
                      <input type="checkbox" data-value="Option 3" />
                      <label>Option 3</label>
                    </div>
                    <div class="custom-option">
                      <input type="checkbox" data-value="Option 4" />
                      <label>Option 4</label>
                    </div>
                    <div class="custom-option">
                      <input type="checkbox" data-value="Option 5" />
                      <label>Option 5</label>
                    </div>
                    <div class="custom-option">
                      <input type="checkbox" data-value="Option 6" />
                      <label>Option 6</label>
                    </div>
                    <div class="custom-option">
                      <input type="checkbox" data-value="Option 7" />
                      <label>Option 7</label>
                    </div>
                    <div class="no-results">Нет результатов</div>
                  </div>
                </div>
              </div>
              
            </form>
          </div>
          <!-- <div class="button-primary">Далее</div> -->
          <div class="wrapper">
            <h3>Формат сделки <span>*</span></h3>
            <div class="line"></div>
            <div class="form start">
              <ul class="chek-lists-single">
                <li>Хочу купить</li>
                <li>Хочу арендавать</li>
              </ul>
            </div>
          </div>
          <!-- <div class="button-primary inactive">Далее</div> -->
          <div class="wrapper">
            <h3>Тип <span>*</span></h3>
            <div class="line"></div>
           
          </div>

          <a href="my-applications.html" class="button-primary hide"
            >Опубликовать заявку</a
          >
        </div>
      </section>
    </main>
    <div id="modal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-button"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M18.3647 5.63567C18.7552 6.02619 18.7552 6.65936 18.3647 7.04988L13.4148 11.9998L18.3646 16.9495C18.7551 17.34 18.7551 17.9732 18.3646 18.3637C17.974 18.7543 17.3409 18.7543 16.9504 18.3637L12.0006 13.414L7.05099 18.3636C6.66047 18.7541 6.0273 18.7541 5.63678 18.3636C5.24625 17.9731 5.24625 17.3399 5.63678 16.9494L10.5864 11.9998L5.63664 7.05002C5.24612 6.6595 5.24612 6.02633 5.63664 5.63581C6.02717 5.24528 6.66033 5.24528 7.05086 5.63581L12.0006 10.5856L16.9505 5.63567C17.341 5.24514 17.9742 5.24514 18.3647 5.63567Z"
              fill="#7786A5"
            /></svg
        ></span>
        <div id="modal-body"></div>
      </div>
      <script>
        document.body.addEventListener("click", function (event) {
          if (event.target.classList.contains("form-next")) {
            event.target.classList.add("hide");

            var modalContent = event.target.closest(".modal-content");

            var confirmElement = modalContent.querySelector(".confirm");

            if (confirmElement) {
              confirmElement.classList.add("active");
            }
          }
        });
      </script>
    </div>
    <!-- Подключение jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Подключение Inputmask -->
    <script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.8-beta.0/dist/inputmask.min.js"></script>
    <script src="js/script.js"></script>
    <script>
      //счетчик вводимых символов
      const textarea = document.getElementById("myTextarea");
      const charCounter = document.getElementById("charCounter");

      textarea.addEventListener("input", () => {
        const currentLength = textarea.value.length;
        charCounter.textContent = `${currentLength}/500`;
      });
    </script>
    <script>
      // прогресс бар
      let progress = 0;

      function move() {
        if (progress < 100) {
          progress += 10;
          const progressBar = document.getElementById("progressBar");
          progressBar.style.width = progress + "%";
        }
      }
    </script>
    <script>
      // кнопки Далее
      document.addEventListener("DOMContentLoaded", () => {
        const buttons = document.querySelectorAll(".button-primary");
        const lastButton = buttons[buttons.length - 1];
        const createProfileButton = document.querySelector(
          ".button-primary.hide"
        );
        let progress = 0;
        const progressBar = document.getElementById("progressBar");

        buttons.forEach((button, index) => {
          button.addEventListener("click", () => {
            // Скрыть текущую кнопку
            button.classList.add("hide");

            // Показать следующий блок wrapper
            const nextWrapper = button.nextElementSibling;
            if (nextWrapper && nextWrapper.classList.contains("wrapper")) {
              nextWrapper.classList.remove("hide");
            }

            // Показать следующую кнопку или кнопку "Создать профиль"
            if (index < buttons.length - 2) {
              buttons[index + 1].classList.remove("inactive");
            } else if (index === buttons.length - 2) {
              // Последняя кнопка "Далее" была нажата
              createProfileButton.classList.remove("hide");
            }

            // Обновление прогрессбара
            if (progress < 100) {
              progress += 20; // Увеличиваем прогресс на 20% за каждую кнопку
              progressBar.style.width = progress + "%";
            }
          });
        });
      });
    </script>
    <script>
      document.querySelectorAll(".upload-container").forEach((container) => {
        const fileInput = container.querySelector('input[type="file"]');
        const preview = container.querySelector(".preview");
        const multiple = container.getAttribute("data-multiple") === "true";

        container.addEventListener("click", () => {
          fileInput.click();
        });

        container.addEventListener("dragover", (event) => {
          event.preventDefault();
          container.classList.add("dragover");
        });

        container.addEventListener("dragleave", () => {
          container.classList.remove("dragover");
        });

        container.addEventListener("drop", (event) => {
          event.preventDefault();
          container.classList.remove("dragover");

          const files = event.dataTransfer.files;
          if (files.length) {
            handleFiles(files, preview, multiple, container);
          }
        });

        fileInput.addEventListener("change", (event) => {
          handleFiles(event.target.files, preview, multiple, container);
        });
      });

      function handleFiles(files, preview, multiple, container) {
        if (!multiple) {
          preview.innerHTML = "";
        }

        Array.from(files).forEach((file) => {
          if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = (event) => {
              // Создаем wrapper для каждого изображения
              const previewWrapper = document.createElement("div");
              previewWrapper.classList.add("preview-wrapper");

              const img = document.createElement("img");
              img.src = event.target.result;

              // Создаем кнопку для удаления
              const removeBtn = document.createElement("button");
              removeBtn.classList.add("remove-btn");
              //removeBtn.textContent = "×";
              removeBtn.addEventListener("click", (e) => {
                e.stopPropagation(); // Останавливаем всплытие события
                e.preventDefault(); // Останавливаем действие по умолчанию
                preview.removeChild(previewWrapper);
              });

              // Добавляем изображение и кнопку в preview-wrapper
              previewWrapper.appendChild(img);
              previewWrapper.appendChild(removeBtn);

              // Добавляем preview-wrapper в общий контейнер preview
              preview.appendChild(previewWrapper);

              container.classList.add("full");
            };
            reader.readAsDataURL(file);
          } else {
            alert("Please upload an image file.");
          }
        });
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const maxForms = 3;
        const videoFormsContainer = document.getElementById(
          "videoFormsContainer"
        );
        const addVideoBtn = document.getElementById("addVideoBtn");

        addVideoBtn.addEventListener("click", () => {
          if (videoFormsContainer.children.length < maxForms) {
            const videoForm = document.createElement("div");
            videoForm.classList.add("video-form");

            const videoNameInput = document.createElement("input");
            videoNameInput.type = "text";
            videoNameInput.placeholder = "Название видео";

            const videoLinkInput = document.createElement("input");
            videoLinkInput.type = "text";
            videoLinkInput.placeholder = "Ссылка на видео";

            const removeBtn = document.createElement("button");
            removeBtn.classList.add("remove-btn");
            removeBtn.textContent = "×";
            removeBtn.addEventListener("click", () => {
              videoFormsContainer.removeChild(videoForm);
              if (videoFormsContainer.children.length < maxForms) {
                addVideoBtn.classList.remove("off"); // Убираем класс off, если форма удалена и лимит не достигнут
              }
            });

            videoForm.appendChild(videoNameInput);
            videoForm.appendChild(videoLinkInput);
            videoForm.appendChild(removeBtn);

            videoFormsContainer.appendChild(videoForm);

            if (videoFormsContainer.children.length === maxForms) {
              addVideoBtn.classList.add("off"); // Добавляем класс off, если достигнут лимит форм
            }
          }
        });
      });
    </script>
    <script>
      document.querySelectorAll(".multi-select").forEach((multiSelect) => {
        const select = multiSelect.querySelector("select");
        const selectedItems = multiSelect.querySelector(".selected-items");

        select.addEventListener("change", () => {
          const selectedValue = select.value;
          const selectedText = select.options[select.selectedIndex].text;

          // Проверка, что элемент уже не добавлен
          if (
            [...selectedItems.children].some(
              (li) => li.dataset.value === selectedValue
            )
          ) {
            alert("Этот пункт уже добавлен.");
            return;
          }

          // Создаем элемент списка
          const li = document.createElement("li");
          li.dataset.value = selectedValue;
          li.textContent = selectedText;

          // Создаем кнопку для удаления
          const removeBtn = document.createElement("span");
          removeBtn.textContent = " ×";
          removeBtn.addEventListener("click", () => {
            selectedItems.removeChild(li);
            updateSelectClass(select, selectedItems);
            // Показать опцию снова в селекте
            const option = select.querySelector(
              `option[value="${selectedValue}"]`
            );
            if (option) option.classList.remove("hidden");
          });

          li.appendChild(removeBtn);
          selectedItems.appendChild(li);

          // Скрываем выбранную опцию
          const option = select.querySelector(
            `option[value="${selectedValue}"]`
          );
          if (option) option.classList.add("hidden");

          // Обновляем класс select и сбрасываем выбор
          updateSelectClass(select, selectedItems);
          select.value = "";
        });

        // Функция обновления класса select
        function updateSelectClass(select, selectedItems) {
          if (selectedItems.children.length > 0) {
            select.classList.add("full");
          } else {
            select.classList.remove("full");
          }
        }
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Функция для открытия/закрытия опций
        window.toggleOptions = function (element) {
          const container = element.closest(".custom-select-container");
          const options = container.querySelector(".custom-options");
          const placeholder = container.querySelector(".select-placeholder");
          const searchInput = container.querySelector(".search-input");

          const isOpen = options.classList.toggle("open");
          container.classList.toggle("active", isOpen);

          if (isOpen) {
            if (placeholder) {
              placeholder.classList.add("active");
            }
            if (searchInput) {
              searchInput.classList.add("active");
              setTimeout(() => {
                searchInput.focus(); // Устанавливаем фокус на поле поиска после его отображения
              }, 0);
            }
          } else {
            if (placeholder) {
              placeholder.classList.remove("active");
            }
            if (searchInput) {
              searchInput.classList.remove("active");
              searchInput.value = ""; // Очищаем поле поиска
              resetOptions(container); // Сбрасываем отображение всех опций
            }
          }
        };

        // Функция для переключения состояния чекбоксов
        function toggleCheckbox(option) {
          const checkbox = option.querySelector("input[type='checkbox']");
          if (checkbox) {
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event("change"));
          }
        }

        // Функция для фильтрации опций по введенному тексту
        window.filterOptions = function (inputElement) {
          const input = inputElement.value.toLowerCase();
          const container = inputElement.closest(".custom-select-container");
          const options = container.querySelectorAll(".custom-option");
          const headings = container.querySelectorAll("h4");
          let hasMatch = false;

          options.forEach((option) => {
            const label = option
              .querySelector("label")
              .textContent.toLowerCase();
            if (label.includes(input)) {
              option.style.display = "flex";
              hasMatch = true;
            } else {
              option.style.display = "none";
            }
          });

          headings.forEach((heading) => {
            let nextElement = heading.nextElementSibling;
            let allHidden = true;

            while (
              nextElement &&
              nextElement.classList.contains("custom-option")
            ) {
              if (nextElement.style.display !== "none") {
                allHidden = false;
                break;
              }
              nextElement = nextElement.nextElementSibling;
            }

            heading.style.display = allHidden ? "none" : "block";
          });

          container.querySelector(".no-results").style.display = hasMatch
            ? "none"
            : "block";
        };

        // Функция для сброса отображения всех опций
        function resetOptions(container) {
          const options = container.querySelectorAll(".custom-option");
          const headings = container.querySelectorAll("h4");
          options.forEach((option) => {
            option.style.display = "flex"; // Показать все опции
          });
          headings.forEach((heading) => {
            heading.style.display = "block"; // Показать все заголовки
          });
          container.querySelector(".no-results").style.display = "none"; // Скрыть сообщение об отсутствии результатов
        }

        // Функция для удаления выбранного элемента
        window.removeItem = function (element) {
          const value =
            element.previousElementSibling.getAttribute("data-value");
          const container = element.closest(".custom-select-container");
          const checkbox = container.querySelector(
            `.custom-option input[data-value="${value}"]`
          );
          if (checkbox) {
            checkbox.checked = false;
            checkbox.dispatchEvent(new Event("change"));
          }
          element.parentElement.remove();
        };

        // Закрытие всех открытых списков при клике вне их области
        document.addEventListener("click", function (event) {
          document
            .querySelectorAll(".custom-options.open")
            .forEach((options) => {
              if (!options.parentElement.contains(event.target)) {
                options.classList.remove("open");
                const container = options.closest(".custom-select-container");
                container.classList.remove("active");
                const placeholder = container.querySelector(
                  ".select-placeholder"
                );
                const searchInput = container.querySelector(".search-input");
                if (placeholder) placeholder.classList.remove("active");
                if (searchInput) {
                  searchInput.classList.remove("active");
                  searchInput.value = ""; // Очищаем поле поиска при закрытии списка
                  resetOptions(container); // Сбрасываем отображение всех опций
                }
              }
            });
        });

        // Обработчики событий для всех custom-option и checkbox
        document.querySelectorAll(".custom-option").forEach((option) => {
          option.addEventListener("click", function (event) {
            // Проверка, чтобы избежать двойной обработки клика
            if (
              !event.target.classList.contains("remove-item") &&
              event.target.tagName !== "INPUT"
            ) {
              toggleCheckbox(option);
            }
          });
        });

        document
          .querySelectorAll(".custom-option input")
          .forEach((checkbox) => {
            checkbox.addEventListener("change", () => {
              const container = checkbox.closest(".custom-select-container");
              const selectedItems = container.querySelector(".selected-items");
              const value = checkbox.dataset.value;

              if (checkbox.checked) {
                if (
                  !selectedItems.querySelector(
                    `.selected-item span[data-value="${value}"]`
                  )
                ) {
                  const item = document.createElement("div");
                  item.classList.add("selected-item");
                  item.innerHTML = `<span data-value="${value}">${value}</span><span class="remove-item" onclick="removeItem(this)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M12.3034 3.69867C12.5963 3.99157 12.5963 4.46644 12.3034 4.75933L9.06236 8.00033L12.3033 11.2412C12.5962 11.5341 12.5962 12.009 12.3033 12.3019C12.0104 12.5948 11.5355 12.5948 11.2426 12.3019L8.0017 9.06099L4.76089 12.3018C4.46799 12.5947 3.99312 12.5947 3.70023 12.3018C3.40733 12.0089 3.40733 11.534 3.70023 11.2411L6.94104 8.00033L3.70014 4.75943C3.40725 4.46653 3.40725 3.99166 3.70014 3.69877C3.99303 3.40587 4.46791 3.40587 4.7608 3.69877L8.0017 6.93967L11.2427 3.69867C11.5356 3.40578 12.0105 3.40578 12.3034 3.69867Z" fill="#7786A5"/>
        </svg></span>`;
                  selectedItems.appendChild(item);
                }
              } else {
                const item = selectedItems.querySelector(
                  `.selected-item span[data-value="${value}"]`
                );
                if (item) item.parentElement.remove();
              }
            });
          });
      });
    </script>
    <script>
      // чек-листы одиночный выбор
      document.addEventListener("DOMContentLoaded", () => {
        const listItems2 = document.querySelectorAll(
          ".form .chek-lists-single li"
        );

        listItems2.forEach(function (item) {
          item.addEventListener("click", function () {
            // Снять класс active со всех пунктов списка
            listItems2.forEach(function (el) {
              el.classList.remove("active");
            });
            // Добавить класс active к выбранному пункту
            item.classList.add("active");
          });
        });

        // чек-листы мультивыбор
        const listItems = document.querySelectorAll(".form .chek-lists li");
        listItems.forEach(function (item) {
          item.addEventListener("click", function () {
            item.classList.toggle("active");
          });
        });

        // обработка числовых полей
        const numberInputs = document.querySelectorAll(".number-input");
        numberInputs.forEach(function (input) {
          function formatNumber(value) {
            return value
              .replace(/\D/g, "")
              .replace(/\B(?=(\d{3})+(?!\d))/g, " ");
          }

          function applyStyles() {
            const parent = input.closest(".input-container");
            const placeholder = parent.querySelector(".placeholder");
            if (input.value) {
              input.classList.add("filled");
              placeholder.classList.add("filled");
            } else {
              input.classList.remove("filled");
              placeholder.classList.remove("filled");
            }
          }

          input.addEventListener("input", function () {
            // Remove all non-digit characters
            let value = input.value.replace(/\s+/g, "").replace(/\D/g, "");

            // Ensure the value respects the min, max and maxlength constraints
            const min = parseInt(input.getAttribute("min"), 10);
            const max = parseInt(input.getAttribute("max"), 10);
            const maxLength = parseInt(input.getAttribute("maxlength"), 10);

            // Limit the length of the input
            if (maxLength && value.length > maxLength) {
              value = value.slice(0, maxLength);
            }

            // Only set value if it's within the min and max range and has maxLength digits
            if (value && value.length === maxLength) {
              const intValue = parseInt(value, 10);
              if (intValue < min) {
                value = min.toString();
              } else if (intValue > max) {
                value = max.toString();
              }
            }

            input.value = formatNumber(value);
            // Apply styles
            applyStyles();
          });

          // Initial check to add filled class if input is already filled
          applyStyles();
        });
      });
    </script>
  </body>
</html>
