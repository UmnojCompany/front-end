<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Custom Select</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/media.css" />
    <link rel="stylesheet" href="css/selects.css" />
  </head>
  <body>
    <main>
      <div class="container testselects">
        <div class="custom-select-container">
          <div class="select-wrapper">
            <div class="select-placeholder">
              Город недвижимости <span>*</span>
            </div>
            <div class="custom-select" onclick="toggleOptions(this)">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 18 18"
                fill="none"
              >
                <path
                  d="M4.5 7.75L8.64645 11.8964C8.84171 12.0917 9.15829 12.0917 9.35355 11.8964L13.5 7.75"
                  stroke="#7786A5"
                  stroke-width="1.5"
                  stroke-linecap="round"
                />
              </svg>
            </div>
            <div class="selected-items"></div>
          </div>
          <input
            type="text"
            class="search-input"
            placeholder="Поиск..."
            oninput="filterOptions(this)"
          />
          <div class="custom-options">
            <div class="custom-option">
              <input type="checkbox" data-value="Option 1" />
              <label>Option 1</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 2" />
              <label>Option 2</label>
            </div>

            <h4>Test</h4>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 3" />
              <label>Option 3</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 4" />
              <label>Option 4</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 5" />
              <label>Option 5</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 6" />
              <label>Option 6</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 7" />
              <label>Option 7</label>
            </div>
            <div class="no-results">Нет результатов</div>
          </div>
        </div>
        <div class="custom-select-container">
          <div class="select-wrapper">
            <div class="select-placeholder">
              Город недвижимости <span>*</span>
            </div>
            <div class="custom-select" onclick="toggleOptions(this)">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 18 18"
                fill="none"
              >
                <path
                  d="M4.5 7.75L8.64645 11.8964C8.84171 12.0917 9.15829 12.0917 9.35355 11.8964L13.5 7.75"
                  stroke="#7786A5"
                  stroke-width="1.5"
                  stroke-linecap="round"
                />
              </svg>
            </div>
            <div class="selected-items"></div>
          </div>
          <input
            type="text"
            class="search-input"
            placeholder="Поиск..."
            oninput="filterOptions(this)"
          />
          <div class="custom-options">
            <div class="custom-option">
              <input type="checkbox" data-value="Option 1" />
              <label>Option 1</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 2" />
              <label>Option 2</label>
            </div>
            <h4>Test</h4>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 3" />
              <label>Option 3</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 4" />
              <label>Option 4</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 5" />
              <label>Option 5</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 6" />
              <label>Option 6</label>
            </div>
            <div class="custom-option">
              <input type="checkbox" data-value="Option 7" />
              <label>Option 7</label>
            </div>
            <div class="no-results">Нет результатов</div>
          </div>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener("click", function (event) {
        document.querySelectorAll(".custom-options").forEach((options) => {
          if (!options.parentElement.contains(event.target)) {
            options.classList.remove("open");
            const container = options.closest(".custom-select-container");
            const placeholder = container.querySelector(".select-placeholder");
            const searchInput = container.querySelector(".search-input");
            container.classList.remove("active");
            if (placeholder) placeholder.classList.remove("active");
            if (searchInput) searchInput.classList.remove("active");
          }
        });
      });

      function toggleOptions(element) {
        const container = element.closest(".custom-select-container");
        const options = container.querySelector(".custom-options");
        const placeholder = container.querySelector(".select-placeholder");
        const searchInput = container.querySelector(".search-input");

        const isOpen = options.classList.toggle("open");
        container.classList.toggle("active", isOpen);

        if (placeholder) {
          placeholder.classList.toggle("active", isOpen);
        }
        if (searchInput) {
          searchInput.classList.toggle("active", isOpen);
        }
      }

      function filterOptions(inputElement) {
        const input = inputElement.value.toLowerCase();
        const container = inputElement.closest(".custom-select-container");
        const options = container.querySelectorAll(".custom-option");
        const headings = container.querySelectorAll("h4");
        let hasMatch = false;

        options.forEach((option) => {
          const label = option.querySelector("label").textContent.toLowerCase();
          if (label.includes(input)) {
            option.style.display = "block";
            hasMatch = true;
          } else {
            option.style.display = "none";
          }
        });

        headings.forEach((heading) => {
          let nextElement = heading.nextElementSibling;
          let allHidden = true;

          while (
            nextElement &&
            nextElement.classList.contains("custom-option")
          ) {
            if (nextElement.style.display !== "none") {
              allHidden = false;
              break;
            }
            nextElement = nextElement.nextElementSibling;
          }

          heading.style.display = allHidden ? "none" : "block";
        });

        container.querySelector(".no-results").style.display = hasMatch
          ? "none"
          : "block";
      }

      // Обработчик клика на custom-option для переключения чекбоксов
      document.querySelectorAll(".custom-option").forEach((option) => {
        option.addEventListener("click", function () {
          const checkbox = option.querySelector("input[type='checkbox']");
          checkbox.checked = !checkbox.checked;
          checkbox.dispatchEvent(new Event("change"));
        });
      });

      document.querySelectorAll(".custom-option input").forEach((checkbox) => {
        checkbox.addEventListener("change", () => {
          const selectedItems = checkbox
            .closest(".custom-select-container")
            .querySelector(".selected-items");
          const value = checkbox.dataset.value;

          if (checkbox.checked) {
            if (
              !selectedItems.querySelector(
                `.selected-item span[data-value="${value}"]`
              )
            ) {
              const item = document.createElement("div");
              item.classList.add("selected-item");
              item.innerHTML = `<span data-value="${value}">${value}</span><span class="remove-item" onclick="removeItem(this)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M12.3034 3.69867C12.5963 3.99157 12.5963 4.46644 12.3034 4.75933L9.06236 8.00033L12.3033 11.2412C12.5962 11.5341 12.5962 12.009 12.3033 12.3019C12.0104 12.5948 11.5355 12.5948 11.2426 12.3019L8.0017 9.06099L4.76089 12.3018C4.46799 12.5947 3.99312 12.5947 3.70023 12.3018C3.40733 12.0089 3.40733 11.534 3.70023 11.2411L6.94104 8.00033L3.70014 4.75943C3.40725 4.46653 3.40725 3.99166 3.70014 3.69877C3.99303 3.40587 4.46791 3.40587 4.7608 3.69877L8.0017 6.93967L11.2427 3.69867C11.5356 3.40578 12.0105 3.40578 12.3034 3.69867Z" fill="#7786A5"/>
</svg></span>`;
              selectedItems.appendChild(item);
            }
          } else {
            selectedItems
              .querySelector(`.selected-item span[data-value="${value}"]`)
              .parentElement.remove();
          }
        });
      });

      function removeItem(element) {
        const value = element.previousElementSibling.getAttribute("data-value");
        const checkbox = document.querySelector(
          `.custom-option input[data-value="${value}"]`
        );
        checkbox.checked = false;
        element.parentElement.remove();
      }
    </script>
  </body>
</html>
